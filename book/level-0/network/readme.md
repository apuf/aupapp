
Сеть это группа компьютеров и сетевых устройств соединенных между собой
Сети бывают локальными LAN и глобальными WAN
Интернет - это все сети WAN соединенные между собой.

### Начало

У нас есть два устройства и нам нужно соединить их между собой для совместной работы
Предположим это будут 2 ноутбука.

Самый простой способ это соединить их напрямую с помощью кабеля или wi-fi
А так-же настроить сеть.
У каждого устройства в сети есть свой уникальный адрес - MAC адрес, но он может нам сказать только что устройства разные.
Для обмена данными нам нужно настроить оба компьютера так, чтобы они видели друг друга и могли передавать данные.
Данные в сети передаются по протоколу чаще всего это InternetProtocol (ipV4 или ipV6), большая часть протоколов
объединены в стек протоколов TCP/IP. Протоколы это наборы правил по которым строиться сеть и передаются данные.

В протоколе ipV4 каждому компьютеру выдается адрес из 4 диапазонов цифр от 0 до 255.
Согласно протоколу для локальных сетей мы можем использовать сети
192.168.x.x, 10.x.x.x или 172.16.0.0 такие сети называются локальными а адреса неанонсированными или "серыми".
Так как адресов у нас много но те так чтобы хватило всем эти три группы зарезервированы для локальных сетей.

Одному компьютеру мы присвоим адрес 192.168.1.2 а второй будет 192.168.1.3. Для Linux этого достаточно для передачи файлов и игр.
На windows мы еще создадим домашную группу и простая сеть готова!

Если у нас больше 2-х устройств то нам понадобиться хаб или маршрутизатор (роутер).

Хаб устаревшее устройство которое грубо говоря посылает любой пришедший к нему сигнал во все стороны а принимающая
сторона уже определяет ей это было отправлено или нет.

Маршрутизатор уже более сложное устройство которое содержит в себе свою операционную систему и сервисы для сети.

Мы берем обычный роутер с wi-fi на борту, но без интернета и соединяемся с ним по логину и паролю.

Маршрутизатор обычно имеет сервис DHCP (Dynamic Host Configuration Protocol) который еще и выдаст нам ip адрес автоматом.
Сами маршрутизаторы обычно имеют адрес 192.168.1.1, первый компьютер станет 192.168.1.2 второй 192.168.1.3 и смартфон 192.168.1.4

> DHCP это сервис который выдает ip в локальной сети автоматом

Вот у нас уже есть локальная сеть.

Для соединения с друзьями из другой квартиры мы соединим по wifi или проводу сами маршрутизаторы и создадим мост.
Где первая квартира 192.168.1.* а вторая 192.168.2.*

Данные из маршрутизатора 192.168.1.1 попадут в 192.168.1.2 только если 192.168.1.x будет передавать данные 192.168.2.x или наоборот.
 
Иными словами маршрутизаторы будут автоматом строить маршруты внутри сети для чего они и созданы.
 
Глобальная сеть - это огромное количество маршрутизаторов соединенных между собой.

### TCP/IP

[TCP/IP](https://ru.wikipedia.org/wiki/TCP/IP)

Для того чтобы понимать как устроены сети - нужно понять стек протоколов TCP/IP.

Стек делиться на 4 уровня 

* Канальный
* Сетевой
* Транспортный
* Прикладной

#### Канальный уровень
Канальный уровень отвечает за то каким образом соединены устройства (кабели или радиосвязь), каким образом передаются,
принимаются шифруются и дешифруются сигналы.

Канальный уровень это наши провода, оптоволокно или wi-fi и стандарты которые за них отвечают.

В этом уровне находятся стандарты которые описывают количество жил в кабеле, частоты работы wi-fi и другую
техническую информацию. Для системных администраторов и создателей оборудования это важная информация но для
web разработки важано знать только что если не добивает wi-fi или отошел кабель то мы не сможем передать данные.

Данные на этом уровне - всего лишь набор сигналов

#### Сетевой уровень
В этом уровне находятся протоколы передачи данных по сети например: 

* IP (internet protocol)
* ICMP (Internet Control Message Protocol)
* IGMP (internet Group Management Protocol)
* ARP (Address Resolution Protocol)

ARP - позволяет нам получить MAC адрес по ip

ICMP - это служебные сообщения сети, влияют на работу утилит Ping и Traceroute
Если запретить ICMP на сервере тогда невозможно будет выполнить ping для него
На основе ICMP можно сделать тоннель передачи данных и передавать данные между 2-я хостами за NAT

IGMP - управляет широковещательными сообщениями. Такие сообщения доставляются всем компьютерам в сети.

Когда компьютер подключается к сети он посылает IGMP запрос по всей сети и ближайший DHCP сервер присваивает ему
уже ip адрес для этой сессии. Я использую это для того чтобы привязывать MAC адреса к ip.
К примеру в виртуальной сети у меня есть виртуальная машина с postgres базой на борту, я привязываю на DHCP сервере
её MAC адрес к ip 10.10.5.1 и сервер будет выдавать каждый раз когда я её включаю строго заданный ip адрес для неё.

IP существует 2-х версий ipv4 и ipv6.

У ipv4 есть следующие особенности

Адрес состоит из 4 групп из цифр от 0 до 255.

Зарезервированные для служебных нужд ip

10.x.x.x,  172.16.x.x, 192.168.x.x - локальные сети
127.x.x.x - это ваш компьютер и данные отправленные на 127.x.x.x всегда вернуться обратно.
0.0.0.0 - как и любой адрес на конце с 0 - широковещательные адреса - при отправке данных на этот адрес
они уйдут всем устройствам в сети где находиться устройство.

169.254.0.0 - присваиваются самой системой если адрес не может быть выдан

> ipV4 адреса уже почти все выкуплены и вы можете только получить в аренду такой адрес.
> их около 4,22 миллиардов а людей еще больше и каждый имеет по компьютеру, модему и телефону которому нужен адрес

подробнее об ipv4 читайте [тут](https://ru.wikipedia.org/wiki/IPv4)

подробнее об ipv6 читайте [тут](https://ru.wikipedia.org/wiki/IPv6)

Данные на этом уровне являются обертками над пакетами которые содержат сами пакеты + служебную информацию

#### Транспортный уровень

Этот уровень отвечает за протоколы передачи данных, используется поверх ip и добавляет новое понятие порт (сокет)

> порты дописываются к адресу через двоеточие например 127.0.0.1:80 ipv6 адрес заключается в кавычки [::1]:80

Данные на этом уровне являются пакетами, то есть если вы передаете файл, то он разбивается на много частей
и отправляется по сети. такие части содержат служебную информацию + данные.

В этом уровне определены протоколы TCP (transmission control protocol) и UDP (User Datagram Protocol)
Первый гарантирует доставку пакетов, и если пакет не доставлен до получателя то он будет отправлен снова
это отлично подходит для передачи важных данных и файлов.

UDP не гарантирует доставку и хорош для передачи данных которые могут быть потеряны.
Например потоки видео или аудио в реальном времени.
Вы не будете ждать пока видео отстанет на несколько кадров при звонке по Skype или слушая онлайн радио.
Если потери небольшие - то вы скорее всего даже разницы не заметете.

У нас уже есть адрес ip но как было бы грустно если у нас с интернетом могла работать только одна программа.
Для этого и были придуманы порты - порт или сокет это некий слот который принимает или отправляет
пакеты. Это позволяет нам использовать несколько программ которым требуется сеть одновременно.
в unix и linux подобных системах есть еще и свои unix-сокеты которые используются внутри самой системы
что позволяет некоторым программам думать что они общаются по сети, хотя по факту данные передаются в самой системе.

Так как провайдеру интернета или нам самим иногда невыгодно арендовать кучу ip адресов то мы использует NAT
с помощью портов.

Технология гениальна - имеется доступный из сети адрес и куча локальных адресов.

Браузер на порту 192.168.1.2:65535 отправляет запрос на 173.194.122.227:443 порт (https://google.com)
запрос уходит к провайдеру с ip x.x.x.x провайдер говорит что этот запрос обслуживает порт 65503
google принимает запрос на свой порт 173.194.122.227:443 и отправляет ответ провайдеру на 
x.x.x.x:65503 тот перенаправляет ответ на ваш роутер который отправляет вам результат на 
192.168.1.2:65535. Провайдер теперь может иметь несколько ipv4 на которых могут висеть десятки тысяч
людей при этом оплачивая копейки за адреса.

Точно так-же у вас есть облако где есть виртуальные машины, основной сервер получает запрос на порт 
443 и он отправляет его на балансировщик который выбирает наиболее свободную машину и она быстрее всего
выдает ответ. Такой подход помогает легко управлять трафиком, держать на одном ip тысячи программ или сайтов.

Еще трафик за NAT можно еще завернуть в другой NAT и еще в NAT и так достаточно много раз, вот только потери
расти и расти, а скорость будет падать и падать.

ipv6 должен решить эту проблему 
>так как количества его адресов достаточно для того чтобы дать адрес каждому атому 
>на **поверхности** земли и еще останется еще на +100 таких поверхностей.
 
Порты пока решают проблему с переходом на ipv6 и кучей приложений на одном адресе.

Множество портов зарезервированы программами
например 22 это ssh, 80 и 443 это сайта с http и https, список портов и программ на них [тут](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BF%D0%BE%D1%80%D1%82%D0%BE%D0%B2_TCP_%D0%B8_UDP)

#### Прикладной уровень

Последний уровень который определяется самим приложением в который
поступили данные, обычно это такие протоколы на HTTP, DHCP, SSH и тд.
Но вы можете написать свой протокол и использовать на этом уровне, тут уже открывается простор для
вашей фантазии. Но лучше все-таки взять уже готовый вариант на котором уже множество людей
работают и поддерживают на достаточно хорошем уровне.


### DNS

Каждый раз набирать 173.194.122.227 для того чтобы погуглить не очень хорошая идея а вот ipv6 адрес
даже безумная. Для того чтобы упростить людям жизнь была придумана DNS (Domain name system)

которая позволяет преобразовать некую последовательность имен в ip адрес.
 
например google.com = 173.194.122.227, 173.194.122.228, 173.194.122.230 ...

Как работает доменный сервер имен?

Есть корневые доменные сервера, которые имеют адрес . её вы не указываете, но она есть.
Эти сервера принадлежат ICANN (Internet Corporation for Assigned Names and Numbers)
которая управляет системой доменов и ip адресами за компанию.

Эти сервера знают о основных зонах интернета - доменах первого уровня, например .ru .com и тд.
С недавнего времени если у вас есть куча серверов по всему миру и куча денег вы можете купить такой
домен и себе например [https://com.google] или [https://xyz.xyz] или [http://россия.рф] 
или даже [http://петя.петя]

Далее сервера которые отвечают за зоны первого уровня могут регистрировать домены второго уровня
 например habrahabr.ru и это уже и есть наши сайты, владельцы доменов второго уровня могут
 уже регистрировать на себя домены второго третьего и тд уровня.
 
#### Как это работает?

1) вы набираете домен
2) ваш браузер проверяет есть ли он в кэше, если есть то отдает сразу иначе идем дальше
3) ваш компьютер ище ближайший DNS сервер (обычно это сервер вашего провайдера) и ищет адрес там, если нет то идем дальше 
4) сервер провайдера обращается к серверу провайдера покрупнее 
...
100500) мы дошли до корневых серверов и мы получим сообщение о том что нет такого сайта
 
Вы можете поднять свой DNS сервер в локальной сети или на своем компьютере и сказать
что обращайся если что к DNS например google 8.8.8.8 и сократить цепочку чтобы сэкономить время

Такой сервер называется кэширующим DNS. Я завел на нем еще и домен .dev для того чтобы все проекты 
на моем компьютере имели адрес 127.0.0.1 что прячет их внутри. Так что все мои проекты 
внутри имя адрес имя-проекта.dev

#### Punycode

Домены с названиями отличными от латиницы например петя.петя будут конвертироваться в нее
по особому формату, например петя.петя = xn--e1atk6c.xn--e1atk6c именно такую ересь передают
DNS в случае доменов с символами национальных алфавитов в доменах

#### Настройка DNS

>выходит за пределы данного раздела и возможно даже и книги 
